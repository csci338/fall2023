---
layout: assignment-two-column
title: Intro to Client-Side Programming with React
type: lab
draft: 1
points: 6
abbreviation: Lab 7
num: 7
start_date: 2023-10-26
due_date: 2023-11-02

---

<style>
    .img {
        width: 80%;
        border: solid 1px black;
    }
    .img-sm {
        width: 50%;
        border: solid 1px black;
        margin: 5px auto;
        display: block;
    }
</style>

In Lab 6, you built a client-side web app using "Vanilla JavaScript." In this lab, you will be building the same client using React. 

## 1. Background Readings and Resources
* TBD

## 2. Set-up

### 2.1. Create a lab07-your-username branch
After completing [Lab 6](lab06), you will create a new branch from your existing `lab06-your-username` branch (from within your `class-exercises-fall2023` repository) as follows:

```sh
git status  # make sure you've committed all of your files
git branch  # verify that you're on the lab06-your-username branch
git checkout -b lab07-your-username  # should create a new branch based on your lab05 branch
git branch  # verify that you're on your new branch
```

When you're done, please make the following modifications to your code:

### 2.2. Modify existing files and add some new ones
In order to run React, we're going use two different Docker images -- one for Python + Fast API, and one for Node.js. To do this, please open VS Code and make the following changesL

#### 2.2.1. Dockerfile
Replace the contents of your current Dockerfile (within the `app` directory) with this:

```sh
# Image for Node.js and React:
from node:lts
COPY ./src/ui /ui
WORKDIR /ui
RUN npm run build

# Image for Python / Fast API
from python:3.11
COPY ./src /app
COPY --from=0 /ui/dist /app/ui/dist
WORKDIR /app
RUN pip install poetry
RUN poetry install
CMD ["poetry", "run", "uvicorn", "server:app", "--host", "0.0.0.0"]
```

#### 2.2.2. compose.yaml
Also in the `app` directory -- on the same level as your Docker file -- create a new file called `compose.yaml` that contains the following:

```sh
services:
  server:
    build:
      context: .
    ports:
      - "8000:8000"
    volumes:
      - ./src:/app
    depends_on:
      ui:
       condition: service_healthy
    entrypoint: poetry run uvicorn server:app --host 0.0.0.0 --reload

  ui:
    image: node:lts
    # user: "${UID}:${GID}"
    ports:
      - "1234:1234"
    volumes:
      - ./src/ui:/app
    working_dir: /app
    healthcheck:
      test: "ls dist"
      timeout: 30s
      interval: 10s
    entrypoint: npm run watch
```

#### 2.2.3. package.json
Inside of `src/ui`, create a new file called `package.json` with the following code:

```json
{
  "scripts": {
    "lint": "html-validate *.html && stylelint **/*.css && eslint *.js",
    "build": "npm install && parcel build index.html",
    "watch": "npm install && parcel watch index.html -no-hmr",
    "format": "prettier -w *.js"
  },
  "devDependencies": {
    "eslint": "^8.51.0",
    "eslint-plugin-react": "^7.33.2",
    "html-validate": "^8.6.0",
    "parcel": "^2.10.0",
    "prettier": "^3.0.3",
    "process": "^0.11.10",
    "react-dom": "^18.2.0",
    "stylelint": "^15.11.0",
    "stylelint-config-standard": "^34.0.0"
  },
  "dependencies": {
    "prop-types": "^15.8.1",
    "react": "^18.2.0"
  }
}
```

#### 2.2.4. Update the .gitignore file
Since we will now be introducing React, some new folders will get created (`node_modules`, `.parcel-cache`, and `dist`). Because these directories contain code that has been generated by third-party modules, they are typically excluded from version control using the `.gitignore` file. Therefore, please open your `.gitignore` file (at the root of your `app`) and add the following lines:

```sh
node_modules
.parcel-cache
dist
```

### 2.3. Build New Docker Images & Container
You are now ready to build your Docker container with your new Docker configuration settings. Because you will be building one container based on 2 Docker images, you are going to use the Docker compose command, which you will issue from within your `app` directory (on the command line):

```sh
docker compose up
``` 

Unlike before, the shell processes runs in the foreground (which is actually a good thing because you can debug!). When the installation and build scripts finish, you should see an output line that says something like:

```sh
Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

Your server is now ready to be tested. Please verify that your old "vanilla" client is running: <a href="http://localhost:8000/index.html" target="_blank">http://localhost:8000/index.html</a>


### 2.4. Setup React to work with Parcel
Finally, now that your new Docker instance is configured, you're ready to rewrite your code using react. Please make the following changes:

#### 2.4.1. Server-Side Updates
In `server.py`, change your mount point to `ui/dist` (which is the directory where your bundled client-side files will live). This line should be at the very bottom of `server.py`:

```py
# app.mount("/", StaticFiles(directory="ui", html=True), name="ui")
app.mount("/", StaticFiles(directory="ui/dist", html=True), name="ui")
```

By changing this path, you're telling Fast API that all of your client-side files will come from the bundled version of your files created by Parcel (which happens to be `ui/dist`).

#### 2.4.2. Client-Side File Updates

##### index.html
Rename your current `index.html` file (in `ui`) to `index-vanilla.html`. Then create a new, blank, `index.html` file in the same folder. When you're done, add the following code to `index.html`:

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/tasks.css">
    <script type="module" src="./js/main.js" defer></script>
    <title>React Client</title>
</head>

<body>
    <div id="app"></div>
</body>

</html>
```

##### main.js
Rename your current `main.js` file (in `ui/js`) to `main-vanilla.js`. Then create a new, blank, `main.js` file in the same folder. When you're done, add the following code to `main.js`:


```js
import { React, useState } from "react";
import { createRoot } from "react-dom/client";

function App() {
    return (
        <main>
            <section>
                <h2>Task List</h2>
                <div className="task-list"></div>
            </section>
            <form className="add-task">Form goes here</form>
        </main>
    );
}

function main() {
    const root = createRoot(document.getElementById("app"));
    root.render(<App />);
}

window.onload = main;
```

You are now ready to begin the lab.

## 3. Creating Components



## 4. What to Turn In
Please create a pull request with the fully implemented web client (which should be completed inside of your version of your `lab05` folder).